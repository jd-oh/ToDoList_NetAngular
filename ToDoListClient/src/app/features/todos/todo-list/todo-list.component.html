<div class="todo-list-container">
  <div class="todo-header">
    <div class="header-title">
      <mat-icon>checklist</mat-icon>
      <h2>Mis Tareas</h2>
    </div>
    <button mat-raised-button color="primary" (click)="openForm()">
      <mat-icon>add</mat-icon>
      Nueva Tarea
    </button>
  </div>

  <app-todo-filter 
    [currentFilter]="currentFilter()" 
    [dashboard]="dashboard()"
    (filterChange)="onFilterChange($event)">
  </app-todo-filter>

  @if (showForm()) {
    <mat-card class="form-card">
      <mat-card-content>
        <app-todo-form
          (submitTodo)="onCreateTodo($event)"
          (cancel)="closeForm()">
        </app-todo-form>
      </mat-card-content>
    </mat-card>
  }

  @if (loading()) {
    <div class="loading-container">
      <mat-spinner diameter="50"></mat-spinner>
      <p>Cargando tareas...</p>
    </div>
  } @else {
    <div class="todo-items">
      @for (todo of todos(); track trackByTodoId($index, todo)) {
        @if (editingTodo()?.id === todo.id) {
          <mat-card class="form-card">
            <mat-card-content>
              <app-todo-form
                [todo]="todo"
                (submitTodo)="onUpdateTodo({id: todo.id, todo: $event})"
                (cancel)="closeForm()">
              </app-todo-form>
            </mat-card-content>
          </mat-card>
        } @else {
          <app-todo-item
            [todo]="todo"
            (toggle)="onToggleTodo($event)"
            (edit)="onEditTodo($event)"
            (delete)="onDeleteTodo($event)">
          </app-todo-item>
        }
      } @empty {
        <mat-card class="empty-state">
          <mat-card-content>
            <mat-icon class="empty-icon">assignment</mat-icon>
            <h3>No hay tareas</h3>
            <p>
              @switch (currentFilter()) {
                @case ('completed') {
                  No tienes tareas completadas
                }
                @case ('pending') {
                  No tienes tareas pendientes
                }
                @default {
                  Comienza creando tu primera tarea
                }
              }
            </p>
            <button mat-stroked-button color="primary" (click)="openForm()">
              <mat-icon>add</mat-icon>
              Crear primera tarea
            </button>
          </mat-card-content>
        </mat-card>
      }
    </div>
  }
</div>
